{% extends 'base.html' %}

{% block style %}
<style>
    table {table-layout: fixed; border-top-color : white}
    th, td {text-align: center;}

    /*글쓰기 버튼이 있는 행*/
    tr:first-child td {border : none; padding: 5px 0}

    tr:first-child td:last-child { text-align: right }

    /*.searchbox { line-height: 25px}*/
    /*.searchbox * {vertical-align: middle}*/
    /*td input, td select {padding:3px}*/
    /*td button {padding : 2px}*/

    /*제목열에 대한 스타일 지정*/
    td:nth-child(2) {text-align: left; white-space: nowrap; overflow: hidden;
        text-overflow: ellipsis}

    /* 페이지네이션 스타일*/
    .pagination a:link {color : darkslategray}

</style>
{% endblock %}

{% block main %}
<main>
    <h2>갤러리 목록</h2>
    <table class="table-bordered w-75 container mt-5" id="board">
        <tr>
            <td colspan="2" class="searchbox">
                <div class="row">
                    <div class="col-auto">
                        <select class="form-select" name="ftype" id="ftype">
                            <option value="contents">본문</option><option value="userid">작성자</option>
                            <option value="title">제목</option><option value="titconts">제목 + 본문</option>
                            <option value="commdngs">댓글내용</option>
                        </select>
                    </div>
                    <div class="col-auto"><input type="text" name="fkey" id="fkey" class="form-control"></div>
                    <div class="col-auto"><button type="button" id="findbtn"
                                                  class="btn btn-success">검색하기</button></div>
                </div>
            </td>
            <td colspan="3"><a href="/gallery/write" class="btn btn-dark text-white">글쓰기</a></td>
        </tr>
    </table>

    <div class="row justify-content-center">
        {% for gal in gallist %}
        <div class="col-10 card m-2" style="width: 18rem">
            <img src="http://localhost/cdn/{{ gal.fname }}" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">{{ gal.title }}</h5>
                <div><span>{{ gal.userid }}</span><span>작성일 : {{ gal.regdate }}</span></div>
                <div><span><i class="bi bi-eye"></i> {{ gal.views }}</span></div>
            </div>
        </div>
        {% endfor %}
    </div><!-- 갤러리 이미지 리스트 -->

    <ul class="pagination justify-content-center mt-4">
<!--        현재 페이지가 1이라면 이전 버튼 비활성-->
        {% if cpg == 1 %}
        <li class="page-item disabled">
        {% else %}
        <li class="page-item">
        {% endif %}
            <a class="page-link" href="{{ baseurl }}{{ cpg - 1 }}">이전</a></li>

        {% for idx in range(stpg, stpg + 10) %}
            <!-- idx가  allpage보다 같거나 작으면 페이지네이션 출력 -->
            {% if idx <= allpage %}
                {% if cpg == idx %} <!-- 현재 페이지가 마지막 페이지라면 이전 버튼 비활성 -->
                <li class="page-item active">
                    {% else %}
                <li class="page-item">
                {% endif %}
                <a class="page-link" href="{{ baseurl }}{{ idx }}">{{ idx }}</a></li>
            {% endif %}
        {% endfor %}

        {% if cpg == allpage %} <!-- 현재 페이지가 마지막 페이지라면 이전 버튼 비활성 -->
        <li class="page-item disabled">
            {% else %}
        <li class="page-item">
            {% endif %}
        <a class="page-link" href="{{ baseurl }}{{ cpg + 1 }}">다음</a></li>
    </ul>
</main>
{% endblock %}

{% block script %}
<script>
    let findbtn = document.querySelector('#findbtn');
    findbtn.addEventListener('click', () => {
        let ftype = document.querySelector('#ftype').value;
        let fkey = document.querySelector('#fkey').value;

        let params = `/${ftype}/${fkey}/1`;
        let findurl = 'http://127.0.0.1:8000/board/list'+params;

        location.href = findurl;
    })
</script>
<script>
    // url의 상태에 따라 검색 UI에 내용 채움
    let findurl = location.pathname.split('/');
    // console.log(findurl[3], findurl[4]);
    if (findurl[4] !== undefined) {
        let classname = 'bg-warning text-white'
        // 검색어를 검색 UI에 자동삽입
        document.querySelector('#fkey').value = decodeURI(findurl[4]);
        document.querySelector('#fkey').className = `form-control ${classname}`;


        // 검색유형을 select 태그에 반영 : selectedIndex이용
        let ftype = document.querySelector('#ftype');
        ftype.className = `form-select ${classname}`;
        switch (findurl[3]) {
            case 'contents' : ftype.selectedIndex = 0; break;
            case 'userid' : ftype.selectedIndex = 1; break;
            case 'title' : ftype.selectedIndex = 2; break;
            case 'titconts' : ftype.selectedIndex = 3; break;
            case 'comments' : ftype.selectedIndex = 4; break;
        }
    }
</script>
{% endblock %}
